---
- hosts: localhost
  name: Configure Samba
  vars:
    ansible_python_interpreter: "/usr/bin/python3"

  tasks:
    - name: Install packages for Samba
      dnf:
        name:
          - samba
          - samba-client
        state: latest

    - name: Enable Smb Service
      systemd:
        name: smb
        state: started
        enabled: yes

    - name: Enable Nmb Service
      systemd:
        name: nmb
        state: started
        enabled: yes
    
    - name: Enable SMB in firewall
      firewalld:
        service: samba
        permanent: true
        state: enabled
      notify: reload firewall

    - name: Set SELinux for /mnt/transport chcon
      command: chcon -R -t samba_share_t /mnt/transport
    
    - name: Allow Samba to modify files in /mnt/transport
      community.general.sefcontext:
        target: '/mnt/transport(/.*)?'
        setype: samba_share_t
        state: present
    
#    - name: Set SELinux for /mnt/transport semanage
#      command: semanage fcontext -a -t samba_share_t "/mnt/transport(/.*)?"

  handlers:
    - name: reload firewall
      systemd:
        name: firewalld
        state: reloaded